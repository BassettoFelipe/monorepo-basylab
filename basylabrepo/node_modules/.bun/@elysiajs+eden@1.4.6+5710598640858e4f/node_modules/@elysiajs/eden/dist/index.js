"use strict";var U=Object.defineProperty;var se=Object.getOwnPropertyDescriptor;var ae=Object.getOwnPropertyNames;var ie=Object.prototype.hasOwnProperty;var oe=(e,t)=>{for(var n in t)U(e,n,{get:t[n],enumerable:!0})},ce=(e,t,n,r)=>{if(t&&typeof t=="object"||typeof t=="function")for(let s of ae(t))!ie.call(e,s)&&s!==n&&U(e,s,{get:()=>t[s],enumerable:!(r=se(t,s))||r.enumerable});return e};var fe=e=>ce(U({},"__esModule",{value:!0}),e);var ke={};oe(ke,{EdenFetchError:()=>S,edenFetch:()=>re,edenTreaty:()=>ne,treaty:()=>X});module.exports=fe(ke);var S=class extends Error{constructor(n,r){super(r+"");this.status=n;this.value=r}};var de=/(\d{4}-[01]\d-[0-3]\dT[0-2]\d:[0-5]\d:[0-5]\d\.\d+([+-][0-2]\d:[0-5]\d|Z))|(\d{4}-[01]\d-[0-3]\dT[0-2]\d:[0-5]\d:[0-5]\d([+-][0-2]\d:[0-5]\d|Z))|(\d{4}-[01]\d-[0-3]\dT[0-2]\d:[0-5]\d([+-][0-2]\d:[0-5]\d|Z))/,ue=/(?:Sun|Mon|Tue|Wed|Thu|Fri|Sat)\s(?:Jan|Feb|Mar|Apr|May|Jun|Jul|Aug|Sep|Oct|Nov|Dec)\s\d{2}\s\d{4}\s\d{2}:\d{2}:\d{2}\sGMT(?:\+|-)\d{4}\s\([^)]+\)/,ye=/^(?:(?:(?:(?:0?[1-9]|[12][0-9]|3[01])[/\s-](?:0?[1-9]|1[0-2])[/\s-](?:19|20)\d{2})|(?:(?:19|20)\d{2}[/\s-](?:0?[1-9]|1[0-2])[/\s-](?:0?[1-9]|[12][0-9]|3[01]))))(?:\s(?:1[012]|0?[1-9]):[0-5][0-9](?::[0-5][0-9])?(?:\s[AP]M)?)?$/,le=e=>e.trim().length!==0&&!Number.isNaN(Number(e)),D=e=>{if(typeof e!="string")return null;let t=e.replace(/"/g,"");if(de.test(t)||ue.test(t)||ye.test(t)){let n=new Date(t);if(!Number.isNaN(n.getTime()))return n}return null},pe=e=>{let t=e.charCodeAt(0),n=e.charCodeAt(e.length-1);return t===123&&n===125||t===91&&n===93},he=e=>JSON.parse(e,(t,n)=>{let r=D(n);return r||n}),$=e=>{if(!e)return e;if(le(e))return+e;if(e==="true")return!0;if(e==="false")return!1;let t=D(e);if(t)return t;if(pe(e))try{return he(e)}catch{}return e},I=e=>{let t=e.data.toString();return t==="null"?null:$(t)};var P=class{constructor(t){this.url=t;this.ws=new WebSocket(t)}ws;send(t){return Array.isArray(t)?(t.forEach(n=>this.send(n)),this):(this.ws.send(typeof t=="object"?JSON.stringify(t):t.toString()),this)}on(t,n,r){return this.addEventListener(t,n,r)}off(t,n,r){return this.ws.removeEventListener(t,n,r),this}subscribe(t,n){return this.addEventListener("message",t,n)}addEventListener(t,n,r){return this.ws.addEventListener(t,s=>{if(t==="message"){let i=I(s);n({...s,data:i})}else n(s)},r),this}removeEventListener(t,n,r){return this.off(t,n,r),this}close(){return this.ws.close(),this}};var ge=["get","post","put","delete","patch","options","head","connect","subscribe"],Q=["localhost","127.0.0.1","0.0.0.0"],V=typeof FileList>"u",q=e=>V?e instanceof Blob:e instanceof FileList||e instanceof File,me=e=>{if(!e)return!1;for(let t in e)if(q(e[t])||Array.isArray(e[t])&&e[t].find(q))return!0;return!1},B=e=>V?e:new Promise(t=>{let n=new FileReader;n.onload=()=>{let r=new File([n.result],e.name,{lastModified:e.lastModified,type:e.type});t(r)},n.readAsArrayBuffer(e)}),C=async(e,t,n={},r={})=>{if(Array.isArray(e)){for(let s of e)if(!Array.isArray(s))r=await C(s,t,n,r);else{let i=s[0];if(typeof i=="string")r[i.toLowerCase()]=s[1];else for(let[a,d]of i)r[a.toLowerCase()]=d}return r}if(!e)return r;switch(typeof e){case"function":if(e instanceof Headers)return C(e,t,n,r);let s=await e(t,n);return s?C(s,t,n,r):r;case"object":if(e instanceof Headers)return e.forEach((i,a)=>{r[a.toLowerCase()]=i}),r;for(let[i,a]of Object.entries(e))r[i.toLowerCase()]=a;return r;default:return r}};function z(e){let t=e.split(`
`),n={};for(let r of t){if(!r||r.startsWith(":"))continue;let s=r.indexOf(":");if(s>0){let i=r.slice(0,s).trim(),a=r.slice(s+1).replace(/^ /,"");n[i]=a&&$(a)}}return Object.keys(n).length>0?n:null}function*Z(e){let t;for(;(t=e.value.indexOf(`

`))!==-1;){let n=e.value.slice(0,t);if(e.value=e.value.slice(t+2),n.trim()){let r=z(n);r&&(yield r)}}}async function*we(e){let t=e.body;if(!t)return;let n=t.getReader(),r=new TextDecoder("utf-8"),s={value:""};try{for(;;){let{done:a,value:d}=await n.read();if(a)break;let W=typeof d=="string"?d:r.decode(d,{stream:!0});s.value+=W,yield*Z(s)}let i=r.decode();if(i&&(s.value+=i),yield*Z(s),s.value.trim()){let a=z(s.value);a&&(yield a)}}finally{n.releaseLock()}}var K=(e,t,n=[],r)=>new Proxy(()=>{},{get(s,i){return K(e,t,i==="index"?n:[...n,i],r)},apply(s,i,[a,d]){if(!a||d||typeof a=="object"&&Object.keys(a).length!==1||ge.includes(n.at(-1))){let W=[...n],F=W.pop(),A="/"+W.join("/"),{fetcher:R=fetch,headers:j,onRequest:w,onResponse:k,fetch:E}=t,h=F==="get"||F==="head"||F==="subscribe",N=h?a?.query:d?.query,O="";if(N){let o=(L,b)=>{O+=(O?"&":"?")+`${encodeURIComponent(L)}=${encodeURIComponent(b)}`};for(let[L,b]of Object.entries(N)){if(Array.isArray(b)){for(let c of b)o(L,c);continue}if(b!=null){if(typeof b=="object"){o(L,JSON.stringify(b));continue}o(L,`${b}`)}}}if(F==="subscribe"){let o=e.replace(/^([^]+):\/\//,e.startsWith("https://")?"wss://":e.startsWith("http://")||Q.find(L=>e.includes(L))?"ws://":"wss://")+A+O;return new P(o)}return(async()=>{j=await C(j,A,d);let o={method:F?.toUpperCase(),body:a,...E,headers:j};o.headers={...j,...await C(h?a?.headers:d?.headers,A,o)};let L=h&&typeof a=="object"?a.fetch:d?.fetch;if(o={...o,...L},h&&delete o.body,w){Array.isArray(w)||(w=[w]);for(let u of w){let y=await u(A,o);typeof y=="object"&&(o={...o,...y,headers:{...o.headers,...await C(y.headers,A,o)}})}}if(h&&delete o.body,me(a)){let u=new FormData,y=f=>{if(typeof f=="string"||q(f))return!1;if(typeof f=="object"){if(f!==null)return!0;if(f instanceof Date)return!1}return!1},m=async f=>f instanceof File?await B(f):y(f)?JSON.stringify(f):f;for(let[f,l]of Object.entries(o.body)){if(Array.isArray(l)){if(l.some(v=>typeof v=="object"&&v!==null&&!q(v)))u.append(f,JSON.stringify(l));else for(let v=0;v<l.length;v++){let T=l[v],M=await m(T);u.append(f,M)}continue}if(V){if(Array.isArray(l))for(let x of l)u.append(f,await m(x));else u.append(f,await m(l));continue}if(l instanceof File){u.append(f,await B(l));continue}if(l instanceof FileList){for(let x=0;x<l.length;x++)u.append(f,await B(l[x]));continue}u.append(f,await m(l))}o.body=u}else typeof a=="object"?(o.headers["content-type"]="application/json",o.body=JSON.stringify(a)):a!=null&&(o.headers["content-type"]="text/plain");if(h&&delete o.body,w){Array.isArray(w)||(w=[w]);for(let u of w){let y=await u(A,o);typeof y=="object"&&(o={...o,...y,headers:{...o.headers,...await C(y.headers,A,o)}})}}d?.headers?.["content-type"]&&(o.headers["content-type"]=d?.headers["content-type"]);let b=e+A+O,c;try{c=await(r?.handle(new Request(b,o))??R(b,o))}catch(u){return{data:null,error:new S(503,u),response:void 0,status:503,headers:void 0}}let g=null,p=null;if(k){Array.isArray(k)||(k=[k]);for(let u of k)try{let y=await u(c.clone());if(y!=null){g=y;break}}catch(y){y instanceof S?p=y:p=new S(422,y);break}}if(g!==null)return{data:g,error:p,response:c,status:c.status,headers:c.headers};switch(c.headers.get("Content-Type")?.split(";")[0]){case"text/event-stream":g=we(c);break;case"application/json":g=JSON.parse(await c.text(),(y,m)=>{if(typeof m!="string")return m;let f=D(m);return f||m});break;case"application/octet-stream":g=await c.arrayBuffer();break;case"multipart/form-data":let u=await c.formData();g={},u.forEach((y,m)=>{g[m]=y});break;default:g=await c.text().then($)}return(c.status>=300||c.status<200)&&(p=new S(c.status,g),g=null),{data:g,error:p,response:c,status:c.status,headers:c.headers}})()}return typeof a=="object"?K(e,t,[...n,Object.values(a)[0]],r):K(e,t,n)}}),X=(e,t={})=>typeof e=="string"?(t.keepDomain||(e.includes("://")||(e=(Q.find(n=>e.includes(n))?"http://":"https://")+e),e.endsWith("/")&&(e=e.slice(0,-1))),K(e,t)):(typeof window<"u"&&console.warn("Elysia instance server found on client side, this is not recommended for security reason. Use generic type instead."),K("http://e.ly",t,[],e));var Y=(e,t,n)=>{if(e.endsWith("/")||(e+="/"),t==="index"&&(t=""),!n||!Object.keys(n).length)return`${e}${t}`;let r="";for(let[s,i]of Object.entries(n))r+=`${s}=${i}&`;return`${e}${t}?${r.slice(0,-1)}`};var G=typeof FileList>"u",ee=e=>G?e instanceof Blob:e instanceof FileList||e instanceof File,Ee=e=>{if(!e)return!1;for(let t in e){if(ee(e[t]))return!0;if(Array.isArray(e[t])&&e[t].find(n=>ee(n)))return!0}return!1},H=e=>G?e:new Promise(t=>{let n=new FileReader;n.onload=()=>{let r=new File([n.result],e.name,{lastModified:e.lastModified,type:e.type});t(r)},n.readAsArrayBuffer(e)}),_=class{ws;url;constructor(t){this.ws=new WebSocket(t),this.url=t}send(t){return Array.isArray(t)?(t.forEach(n=>this.send(n)),this):(this.ws.send(typeof t=="object"?JSON.stringify(t):t.toString()),this)}on(t,n,r){return this.addEventListener(t,n,r)}off(t,n,r){return this.ws.removeEventListener(t,n,r),this}subscribe(t,n){return this.addEventListener("message",t,n)}addEventListener(t,n,r){return this.ws.addEventListener(t,s=>{if(t==="message"){let i=I(s);n({...s,data:i})}else n(s)},r),this}removeEventListener(t,n,r){return this.off(t,n,r),this}close(){return this.ws.close(),this}},te=(e,t="",n)=>new Proxy(()=>{},{get(r,s,i){return te(e,`${t}/${s.toString()}`,n)},apply(r,s,[i,a={}]=[{},{}]){let d=i!==void 0&&(typeof i!="object"||Array.isArray(i))?i:void 0,{$query:W,$fetch:F,$headers:A,$transform:R,getRaw:j,...w}=i??{};d??=w;let k=t.lastIndexOf("/"),E=t.slice(k+1).toUpperCase(),h=Y(e,k===-1?"/":t.slice(0,k),Object.assign(a.query??{},W)),N=n.fetcher??fetch,O=n.transform?Array.isArray(n.transform)?n.transform:[n.transform]:void 0,o=R?Array.isArray(R)?R:[R]:void 0;return o&&(O?O=o.concat(O):O=o),E==="SUBSCRIBE"?new _(h.replace(/^([^]+):\/\//,h.startsWith("https://")?"wss://":"ws://")):(async b=>{let c,g={...n.$fetch?.headers,...F?.headers,...a.headers,...A};if(E!=="GET"&&E!=="HEAD"){c=Object.keys(d).length||Array.isArray(d)?d:void 0;let f=c&&(typeof c=="object"||Array.isArray(d));if(f&&Ee(c)){let x=new FormData;for(let[v,T]of Object.entries(c))if(G)x.append(v,T);else if(T instanceof File)x.append(v,await H(T));else if(T instanceof FileList)for(let M=0;M<T.length;M++)x.append(v,await H(T[M]));else if(Array.isArray(T))for(let M=0;M<T.length;M++){let J=T[M];x.append(v,J instanceof File?await H(J):J)}else x.append(v,T);c=x}else c!=null&&(g["content-type"]=f?"application/json":"text/plain",c=f?JSON.stringify(c):d)}let p=await N(h,{method:E,body:c,...n.$fetch,...a.fetch,...F,headers:g}),u;if(b.getRaw)return p;switch(p.headers.get("Content-Type")?.split(";")[0]){case"application/json":u=await p.json();break;default:u=await p.text().then($)}let y=p.status>=300||p.status<200?new S(p.status,u):null,m={data:u,error:y,response:p,status:p.status,headers:p.headers};if(O)for(let f of O){let l=f(m);l instanceof Promise&&(l=await l),l!=null&&(m=l)}return m})({getRaw:j})}}),ne=(e,t={fetcher:fetch})=>new Proxy({},{get(n,r){return te(e,r,t)}});var be=async e=>{switch(e.headers.get("Content-Type")?.split(";")[0]){case"application/json":return e.json();case"application/octet-stream":return e.arrayBuffer();case"multipart/form-data":{let n=await e.formData(),r={};return n.forEach((s,i)=>{r[i]=s}),r}}return e.text().then($)},Se=async(e,t)=>{let n=await be(e);return e.status>300?{data:null,status:e.status,headers:e.headers,retry:t,error:new S(e.status,n)}:{data:n,error:null,status:e.status,headers:e.headers,retry:t}},re=(e,t)=>(n,{query:r,params:s,body:i,...a}={})=>{s&&Object.entries(s).forEach(([E,h])=>{n=n.replace(`:${E}`,h)});let d=t?.fetcher||globalThis.fetch,W=r?Object.fromEntries(Object.entries(r).filter(([E,h])=>h!=null)):null,F=W?`?${new URLSearchParams(W).toString()}`:"",A=`${e}${n}${F}`,R=new Headers(a.headers||{}),j=R.get("content-type");if(!(i instanceof FormData)&&!(i instanceof URLSearchParams)&&(!j||j==="application/json"))try{i=JSON.stringify(i),j||R.set("content-type","application/json")}catch{}let w={...a,method:a.method?.toUpperCase()||"GET",headers:R,body:i},k=()=>d(A,w).then(E=>Se(E,k)).catch(E=>({data:null,error:new S(503,E),status:503,headers:void 0,retry:k}));return k()};0&&(module.exports={EdenFetchError,edenFetch,edenTreaty,treaty});
